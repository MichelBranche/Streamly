<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>Streamly</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- AUTH (prima della home) -->
  <section class="auth" id="authScreen" aria-label="Accesso">
    <div class="auth__card" role="region" aria-label="Crea profilo o accedi">
      <div class="brand brand--hero" aria-label="Streamly">
        <svg class="brand__mark" width="38" height="38" viewBox="0 0 38 38" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#8b5cf6" />
              <stop offset="1" stop-color="#22c55e" />
            </linearGradient>
          </defs>
          <path d="M19 2c-5.9 0-10.7 2.3-13.5 6.1C3.2 10.9 2 14 2 17.4c0 4.2 2.1 7.2 6.3 9 2.7 1.2 6.2 1.9 10.2 2.2 3.3.2 5.2.7 6.3 1.4 1.1.7 1.6 1.6 1.6 2.9 0 1.2-.5 2.2-1.6 2.9-1.6 1.1-3.9 1.7-6.8 1.7-4.7 0-8.6-1.5-11.6-4.4L2.1 32C5.9 36 11.2 38 18 38c4.4 0 8.1-.9 10.9-2.7 2.9-1.9 4.3-4.5 4.3-7.8 0-4.1-2-7.1-6-9-2.4-1.2-5.7-1.9-9.9-2.1-3.6-.2-5.7-.7-6.8-1.4-1.1-.7-1.7-1.6-1.7-2.9 0-1.1.5-2 1.4-2.7C12 8 14.5 7.4 17.6 7.4c4 0 7.2 1.1 9.7 3.3l4.4-4.4C28.4 3.5 24.2 2 19 2Z" fill="url(#g)" />
        </svg>
        <div class="brand__stack">
          <div class="brand__name">Streamly</div>
          <div class="brand__tag">Guarda in sync con chi vuoi</div>
        </div>
      </div>

      <div class="notice" id="authNotice" hidden></div>

      <div class="seg seg--auth" role="tablist" aria-label="Accesso o registrazione">
        <button class="seg__btn is-active" type="button" data-auth-tab="register" role="tab" aria-selected="true">Crea profilo</button>
        <button class="seg__btn" type="button" data-auth-tab="login" role="tab" aria-selected="false">Accedi</button>
      </div>

      <form class="form" id="registerForm" autocomplete="off">
        <div class="form__row">
          <label class="field field--wide">
            <span class="field__label">API Base URL</span>
            <input class="field__input" id="apiBaseInput" type="url" placeholder="https://tuo-server.example" required />
          </label>
        </div>

        <div class="form__row">
          <label class="field">
            <span class="field__label">Username</span>
            <input class="field__input" name="username" type="text" minlength="3" maxlength="24" pattern="[A-Za-z0-9_\-]{3,24}" placeholder="es. michel" required />
          </label>

          <label class="field">
            <span class="field__label">Password</span>
            <input class="field__input" name="password" type="password" minlength="6" maxlength="72" required />
          </label>
        </div>

        <div class="form__row">
          <label class="field field--wide">
            <span class="field__label">Conferma password</span>
            <input class="field__input" name="password2" type="password" minlength="6" maxlength="72" required />
          </label>
        </div>

        <div class="form__actions">
          <button class="btn btn--primary" type="submit">Crea profilo</button>
        </div>

        <p class="fineprint">
          GitHub Pages √® statico: per salvare profili/libreria/poster serve un server API (server.js) su un host.
        </p>
      </form>

      <form class="form" id="loginForm" hidden autocomplete="off">
        <div class="form__row">
          <label class="field field--wide">
            <span class="field__label">API Base URL</span>
            <input class="field__input" id="apiBaseInput2" type="url" placeholder="https://tuo-server.example" required />
          </label>
        </div>

        <div class="form__row">
          <label class="field">
            <span class="field__label">Username</span>
            <input class="field__input" name="username" type="text" minlength="3" maxlength="24" required />
          </label>

          <label class="field">
            <span class="field__label">Password</span>
            <input class="field__input" name="password" type="password" minlength="6" maxlength="72" required />
          </label>
        </div>

        <div class="form__actions">
          <button class="btn btn--primary" type="submit">Accedi</button>
        </div>

        <p class="fineprint">
          Suggerimento: l'URL API e l'URL WebSocket possono coincidere (il server espone anche /ws).
        </p>
      </form>
    </div>
  </section>

  <!-- APP -->
  <div id="app" hidden>
    <header class="topbar">
      <div class="brand" aria-label="Streamly">
        <svg class="brand__mark" width="26" height="26" viewBox="0 0 38 38" aria-hidden="true">
          <defs>
            <linearGradient id="g2" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#8b5cf6" />
              <stop offset="1" stop-color="#22c55e" />
            </linearGradient>
          </defs>
          <path d="M19 2c-5.9 0-10.7 2.3-13.5 6.1C3.2 10.9 2 14 2 17.4c0 4.2 2.1 7.2 6.3 9 2.7 1.2 6.2 1.9 10.2 2.2 3.3.2 5.2.7 6.3 1.4 1.1.7 1.6 1.6 1.6 2.9 0 1.2-.5 2.2-1.6 2.9-1.6 1.1-3.9 1.7-6.8 1.7-4.7 0-8.6-1.5-11.6-4.4L2.1 32C5.9 36 11.2 38 18 38c4.4 0 8.1-.9 10.9-2.7 2.9-1.9 4.3-4.5 4.3-7.8 0-4.1-2-7.1-6-9-2.4-1.2-5.7-1.9-9.9-2.1-3.6-.2-5.7-.7-6.8-1.4-1.1-.7-1.7-1.6-1.7-2.9 0-1.1.5-2 1.4-2.7C12 8 14.5 7.4 17.6 7.4c4 0 7.2 1.1 9.7 3.3l4.4-4.4C28.4 3.5 24.2 2 19 2Z" fill="url(#g2)" />
        </svg>
        <span class="brand__name">Streamly</span>
      </div>

      <div class="topbar__actions">
        <div class="userpill" id="userPill" title="Profilo">
          <span class="userpill__name" id="userName">‚Äî</span>
          <button class="btn btn--ghost btn--sm" id="btnLogout" type="button">Logout</button>
        </div>

        <button id="btnAdd" class="btn btn--primary" type="button">
          <span class="btn__icon" aria-hidden="true">Ôºã</span>
          Aggiungi
        </button>

        <button id="btnSettings" class="btn btn--ghost" type="button" aria-haspopup="dialog" aria-controls="settingsModal">
          Impostazioni
        </button>
      </div>
    </header>

    <main class="wrap">
      <section class="toolbar" aria-label="Filtri e ricerca">
        <div class="toolbar__left">
          <div class="seg" role="tablist" aria-label="Filtro contenuti">
            <button class="seg__btn is-active" type="button" data-filter="all" role="tab" aria-selected="true">Tutto</button>
            <button class="seg__btn" type="button" data-filter="watchlist" role="tab" aria-selected="false">Watchlist</button>
            <button class="seg__btn" type="button" data-filter="liked" role="tab" aria-selected="false">Like</button>
          </div>
        </div>

        <div class="toolbar__right">
          <label class="search">
            <span class="sr-only">Cerca</span>
            <input id="searchInput" class="search__input" type="search" placeholder="Cerca in libreria‚Ä¶" autocomplete="off" />
            <span class="search__icon" aria-hidden="true">‚åï</span>
          </label>

          <div class="select">
            <label class="sr-only" for="sortSelect">Ordina</label>
            <select id="sortSelect" class="select__input">
              <option value="recent">Pi√π recenti</option>
              <option value="title">Titolo (A‚ÜíZ)</option>
              <option value="likes">Pi√π piaciuti</option>
            </select>
          </div>
        </div>
      </section>

      <section class="grid" aria-label="Libreria" id="grid"></section>

      <section class="empty" id="emptyState" hidden>
        <div class="empty__card">
          <h2 class="empty__title">Libreria vuota</h2>
          <p class="empty__text">Aggiungi il primo contenuto (video + poster + trailer opzionale).</p>
          <button class="btn btn--primary" type="button" id="btnAddEmpty">Aggiungi contenuto</button>
        </div>
      </section>
    </main>

    <!-- Add Content Modal -->
    <div class="modal" id="addModal" role="dialog" aria-modal="true" aria-labelledby="addTitle" hidden>
      <div class="modal__backdrop" data-close="addModal"></div>
      <div class="modal__panel" role="document">
        <div class="modal__head">
          <h2 id="addTitle" class="modal__title">Aggiungi contenuto</h2>
          <button class="iconbtn" type="button" aria-label="Chiudi" data-close="addModal">‚úï</button>
        </div>

        <form id="addForm" class="form">
          <div class="form__row">
            <label class="field">
              <span class="field__label">Titolo</span>
              <input class="field__input" name="title" type="text" maxlength="80" required placeholder="Es. Il mio film" />
            </label>

            <label class="field">
              <span class="field__label">Tipo</span>
              <select class="field__input" name="kind">
                <option value="movie">Film</option>
                <option value="series">Serie</option>
                <option value="other">Altro</option>
              </select>
            </label>
          </div>

          <div class="form__row">
            <label class="field field--wide">
              <span class="field__label">Poster (upload)</span>
              <input class="field__input" name="posterFile" type="file" accept="image/*" />
            </label>
          </div>
          <div class="form__row">
            <label class="field field--wide">
              <span class="field__label">Poster URL (opzionale)</span>
              <input class="field__input" name="posterUrl" type="url" placeholder="https://... (se non fai upload)" />
            </label>
          </div>


          <fieldset class="fieldset">
            <legend class="fieldset__legend">Video principale</legend>

            
            <div class="form__row">
              <label class="field field--wide">
                <span class="field__label">Upload file (mp4/webm)</span>
                <input class="field__input" name="videoFile" type="file" accept="video/mp4,video/webm" />
              </label>
            </div>
<div class="form__row">
              <label class="field field--wide">
                <span class="field__label">URL</span>
                <input class="field__input" name="videoUrl" type="url" placeholder="mp4/webm oppure link YouTube/Vimeo" />
              </label>
            </div>

            <div class="hint">
              Supporto: <strong>direct mp4/webm</strong> + <strong>YouTube/Vimeo embed</strong> (se consentito).
            </div>
          </fieldset>

          <fieldset class="fieldset">
            <legend class="fieldset__legend">Trailer (opzionale)</legend>

            
            <div class="form__row">
              <label class="field field--wide">
                <span class="field__label">Trailer (upload mp4/webm, opzionale)</span>
                <input class="field__input" name="trailerFile" type="file" accept="video/mp4,video/webm" />
              </label>
            </div>
<div class="form__row">
              <label class="field field--wide">
                <span class="field__label">Trailer URL</span>
                <input class="field__input" name="trailerUrl" type="url" placeholder="Lascia vuoto se non serve" />
              </label>
            </div>
          </fieldset>

          <div class="form__actions">
            <button class="btn" type="button" data-close="addModal">Annulla</button>
            <button class="btn btn--primary" type="submit">Salva</button>
          </div>

          <p class="fineprint">
            Salvataggio su server: poster + (opzionale) video/trailer upload + libreria per profilo.
          </p>
        </form>
      </div>
    </div>

    <!-- Details Modal -->
    <div class="modal" id="detailsModal" role="dialog" aria-modal="true" aria-labelledby="detailsTitle" hidden>
      <div class="modal__backdrop" data-close="detailsModal"></div>
      <div class="modal__panel modal__panel--details" role="document">
        <div class="modal__head">
          <h2 id="detailsTitle" class="modal__title">Dettagli</h2>
          <button class="iconbtn" type="button" aria-label="Chiudi" data-close="detailsModal">‚úï</button>
        </div>

        <div class="details">
          <div class="details__poster">
            <img id="detailsPoster" alt="" />
          </div>

          <div class="details__body">
            <div class="details__meta">
              <div class="details__name" id="detailsName">‚Äî</div>
              <div class="details__chips" id="detailsChips"></div>
            </div>

            <div class="details__actions">
              <button id="btnPlay" class="btn btn--primary" type="button">Play</button>
              <button id="btnTrailer" class="btn btn--ghost" type="button" hidden>Trailer</button>

              <span class="spacer"></span>

              <button id="btnWatchlist" class="btn btn--ghost" type="button">Watchlist</button>

              <div class="btnrow">
                <button id="btnLike" class="btn btn--ghost" type="button" aria-pressed="false">üëç</button>
                <button id="btnDislike" class="btn btn--ghost" type="button" aria-pressed="false">üëé</button>
              </div>

              <button id="btnDelete" class="btn btn--danger" type="button">Elimina</button>
            </div>

            <div class="details__links">
              <div class="kv">
                <div class="kv__k">Video</div>
                <div class="kv__v" id="detailsVideo">‚Äî</div>
              </div>
              <div class="kv">
                <div class="kv__k">Trailer</div>
                <div class="kv__v" id="detailsTrailer">‚Äî</div>
              </div>
            </div>

            <div class="hint" id="embedHint" hidden>
              Nota: sync perfetto √® garantito con video direct mp4/webm. YouTube/Vimeo: best-effort.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Player Modal -->
    <div class="modal" id="playerModal" role="dialog" aria-modal="true" aria-label="Player" hidden>
      <div class="modal__backdrop" data-close="playerModal"></div>
      <div class="modal__panel modal__panel--player" role="document">
        <div class="playerTop">
          <div class="playerTop__left">
            <div class="playerTop__title" id="playerTitle">‚Äî</div>
            <div class="playerTop__sub" id="playerSub">‚Äî</div>
          </div>

          <div class="playerTop__right">
            <button id="btnParty" class="btn btn--ghost" type="button" aria-haspopup="dialog" aria-controls="partyModal">Watch Party</button>
            <button id="btnCinema" class="btn btn--ghost" type="button" aria-pressed="false">Cinema</button>
            <button id="btnFs" class="btn btn--ghost" type="button">Fullscreen</button>
            <button class="iconbtn" type="button" aria-label="Chiudi player" data-close="playerModal">‚úï</button>
          </div>
        </div>

        <div class="playerStage" id="playerStage"></div>

        <div class="playerFoot">
          <div class="playerFoot__left">
            <button id="btnBackDetails" class="btn btn--ghost" type="button">Dettagli</button>
          </div>
          <div class="playerFoot__right">
            <span class="pill" id="partyStatus" hidden>Party: off</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" hidden>
      <div class="modal__backdrop" data-close="settingsModal"></div>
      <div class="modal__panel" role="document">
        <div class="modal__head">
          <h2 id="settingsTitle" class="modal__title">Impostazioni</h2>
          <button class="iconbtn" type="button" aria-label="Chiudi" data-close="settingsModal">‚úï</button>
        </div>

        <div class="form">
          <div class="form__row">
            <label class="field field--wide">
              <span class="field__label">API Base URL</span>
              <input class="field__input" id="apiBase" type="url" placeholder="https://tuo-server.example" />
            </label>
          </div>

          <div class="form__row">
            <label class="field field--wide">
              <span class="field__label">Modalit√† Watch Party predefinita</span>
              <select class="field__input" id="partyDefaultMode">
                <option value="off">Off</option>
                <option value="local">Local (BroadcastChannel)</option>
                <option value="remote">Remote (WebSocket)</option>
              </select>
            </label>
          </div>

          <div class="form__row">
            <label class="field field--wide">
              <span class="field__label">WebSocket URL (remote)</span>
              <input class="field__input" id="wsUrl" type="url" placeholder="wss://tuo-server.example/ws" />
            </label>
          </div>

          <div class="form__actions">
            <button class="btn btn--primary" id="btnSaveSettings" type="button">Salva</button>
          </div>

          <p class="fineprint">
            Watch Party remoto: due PC distanti, stessa Room, stesso WS.
          </p>
        </div>
      </div>
    </div>

    <!-- Party Modal -->
    <div class="modal" id="partyModal" role="dialog" aria-modal="true" aria-labelledby="partyTitle" hidden>
      <div class="modal__backdrop" data-close="partyModal"></div>
      <div class="modal__panel" role="document">
        <div class="modal__head">
          <h2 id="partyTitle" class="modal__title">Watch Party</h2>
          <button class="iconbtn" type="button" aria-label="Chiudi" data-close="partyModal">‚úï</button>
        </div>

        <div class="form">
          <div class="form__row">
            <label class="field field--wide">
              <span class="field__label">Modalit√†</span>
              <select class="field__input" id="partyMode">
                <option value="local">Local (BroadcastChannel)</option>
                <option value="remote">Remote (WebSocket)</option>
              </select>
            </label>
          </div>

          <div class="form__row">
            <label class="field field--wide">
              <span class="field__label">Room</span>
              <input class="field__input" id="partyRoom" type="text" placeholder="es. serata-film" maxlength="48" />
            </label>
          </div>

          <div class="form__row" id="wsRow">
            <label class="field field--wide">
              <span class="field__label">WebSocket URL</span>
              <input class="field__input" id="partyWsUrl" type="url" placeholder="wss://tuo-server.example/ws" />
            </label>
          </div>

          <div class="form__actions">
            <button class="btn" id="btnPartyLeave" type="button" hidden>Esci</button>
            <button class="btn btn--primary" id="btnPartyJoin" type="button">Avvia / Entra</button>
            <button class="btn btn--ghost" id="btnPartyCopy" type="button" hidden>Copia invito</button>
          </div>

          <p class="fineprint" id="partyFineprint">
            Consiglio: per sync perfetto usa video direct mp4/webm.
          </p>

          <div class="partyBox" id="partyBox" hidden>
            <div class="partyBox__row"><span class="muted">Stato:</span> <span id="partyBoxState">‚Äî</span></div>
            <div class="partyBox__row"><span class="muted">Room:</span> <span id="partyBoxRoom">‚Äî</span></div>
            <div class="partyBox__row"><span class="muted">Modalit√†:</span> <span id="partyBoxMode">‚Äî</span></div>
            <div class="partyBox__row"><span class="muted">Ruolo:</span> <span id="partyBoxRole">‚Äî</span></div>
          </div>
        </div>
      </div>
    </div>

    <template id="tplCard">
      <button class="card" type="button">
        <div class="card__poster">
          <img alt="" loading="lazy" decoding="async" />
        </div>
        <div class="card__overlay">
          <div class="card__top">
            <span class="badge" data-badge="kind">Film</span>
            <span class="chip" data-chip="watchlist" hidden title="In watchlist" aria-label="In watchlist">‚òÖ</span>
          </div>
          <div class="card__bottom">
            <div class="card__title" data-title>‚Äî</div>
            <div class="card__meta">
              <span class="muted" data-meta>‚Äî</span>
              <span class="chip chip--like" data-chip="liked" hidden title="Hai messo like" aria-label="Hai messo like">üëç</span>
            </div>
          </div>
        </div>
      </button>
    </template>
  </div>

  <script src="script.js"></script>
</body>
</html>
